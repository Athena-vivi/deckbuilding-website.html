<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4942713186815141"
     crossorigin="anonymous"></script>
    <meta name="google-adsense-account" content="ca-pub-4942713186815141">
    <title>Deckbuilding: A Sci-Fi Strategy Card Game</title>
    <meta name="description" content="Play Deckbuilding, a free sci-fi card strategy game. Build your fleet, defeat enemy waves, and become the ultimate commander in this browser-based roguelike game.">
    <link rel="canonical" href="https://deckbuilding.space/index.html" />

    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "VideoGame",
      "name": "Deckbuilding: A Sci-Fi Strategy Card Game",
      "url": "https://deckbuilding.space/index.html",
      "description": "A free-to-play browser-based deckbuilding game where you command a star fleet against waves of enemies.",
      "gamePlatform": "PC (Browser)",
      "applicationCategory": "Game",
      "operatingSystem": "Any (Browser)",
      "author": { "@type": "Person", "name": "Deckbuilding Game Studio" },
      "publisher": { "@type": "Person", "name": "Deckbuilding Game Studio" }
    }
    </script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        html, body {
            height: 100%;
        }
        body {
            font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background: linear-gradient(135deg, #0a0a1a 0%, #1a0a2e 50%, #16213e 100%);
            color: #fff; min-height: 100vh; overflow-x: hidden;
        }
        .stars { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 0; }
        .star { position: absolute; background: white; border-radius: 50%; animation: twinkle 2s infinite; }
        @keyframes twinkle { 0%, 100% { opacity: 0.3; } 50% { opacity: 1; } }
        
        @keyframes elite-glow {
            0%, 100% { box-shadow: 0 0 15px 5px rgba(255, 215, 0, 0.7); }
            50% { box-shadow: 0 0 25px 10px rgba(255, 215, 0, 0.9); }
        }

        .container { position: relative; z-index: 1; max-width: 1200px; margin: 0 auto; padding: 24px; }
        .header { text-align: center; margin-bottom: 32px; background: rgba(0, 0, 0, 0.4); padding: 15px; border-radius: 15px; backdrop-filter: blur(10px); }
        .title { font-size: 2.5em; font-weight: 700; background: linear-gradient(45deg, #ff6b35, #f7931e); -webkit-background-clip: text; -webkit-text-fill-color: transparent; text-shadow: 0 0 20px rgba(255, 107, 53, 0.5); }
        .wave-indicator { font-size: 1.1em; color: #ff6b35; font-weight: bold; margin-top: 8px; transition: all 0.5s ease; }
        .elite-wave-indicator { color: gold; text-shadow: 0 0 10px gold; }
        
        .nav {
            text-align: center;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .nav a {
            color: #74b9ff;
            text-decoration: none;
            margin: 0 10px;
            padding: 6px 12px;
            border-radius: 6px;
            transition: all 0.3s ease;
            font-size: 0.9em;
        }
        
        .nav a:hover {
            background: rgba(116, 185, 255, 0.2);
            transform: translateY(-2px);
        }

        h2 { font-size: 1.5em; margin-bottom: 16px; font-weight: 600; color: #eee; }
        .battle-area { display: grid; grid-template-columns: 1fr 1fr; gap: 24px; margin-bottom: 24px; }
        .player-side, .enemy-side { background: rgba(0, 0, 0, 0.5); border-radius: 15px; padding: 20px; border: 3px solid; min-height: 280px; }
        .player-side { border-color: #00ff88; box-shadow: 0 0 20px rgba(0, 255, 136, 0.3); }
        .enemy-side { border-color: #ff4757; box-shadow: 0 0 20px rgba(255, 71, 87, 0.3); }
        .health-bar { width: 100%; height: 28px; background: rgba(0, 0, 0, 0.5); border-radius: 14px; margin-bottom: 16px; overflow: hidden; border: 2px solid #333; }
        .health-fill { height: 100%; transition: width 0.5s ease; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 13px; }
        .player-health { background: linear-gradient(90deg, #00ff88, #00cc70); }
        .enemy-health { background: linear-gradient(90deg, #ff4757, #ff3742); }
        .ship-container { display: flex; flex-wrap: wrap; gap: 12px; min-height: 120px; padding-top: 10px; justify-content: center; align-items: center; }
        .ship { width: 70px; height: 70px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 28px; position: relative; border: 3px solid white; box-shadow: 0 2px 4px rgba(0,0,0,0.1); transition: all 0.3s ease; }
        .player-ship { background: linear-gradient(135deg, #00ff88, #00cc70); }
        .enemy-ship { background: linear-gradient(135deg, #ff4757, #ff3742); }
        .elite-ship { animation: elite-glow 1.5s infinite; border-color: gold; }
        .ship-stats { position: absolute; bottom: -8px; background: rgba(0, 0, 0, 0.75); color: white; border-radius: 8px; padding: 2px 8px; font-size: 11px; font-weight: 600; }
        .enemy-intent { position: absolute; top: -15px; left: 50%; transform: translateX(-50%); background: rgba(0, 0, 0, 0.8); border-radius: 8px; padding: 2px 8px; font-size: 18px; font-weight: bold; border: 1px solid #666; white-space: nowrap; }

        .hand-area { background: rgba(0, 0, 0, 0.4); border-radius: 15px; padding: 20px; margin-bottom: 24px; }
        .hand { display: flex; gap: 16px; overflow-x: auto; padding-bottom: 16px; }
        .card { min-width: 140px; height: 180px; background: linear-gradient(135deg, #1e3c72, #2a5298); border: 2px solid #fff; border-radius: 12px; padding: 12px; cursor: pointer; transition: all 0.3s ease; position: relative; display: flex; flex-direction: column; }
        .card:hover { transform: translateY(-10px) scale(1.05); box-shadow: 0 15px 30px rgba(0, 255, 255, 0.4); }
        .card.playable { border-color: #00ff88; box-shadow: 0 0 15px rgba(0, 255, 136, 0.5); }
        .card.unplayable { opacity: 0.5; cursor: not-allowed; }
        .card-cost { position: absolute; top: -5px; right: -5px; background: #ff6b35; color: white; border-radius: 50%; width: 28px; height: 28px; display: flex; align-items: center; justify-content: center; font-size: 14px; font-weight: 700; border: 2px solid white; }
        .card-name { font-weight: 600; font-size: 16px; margin-bottom: 8px; }
        .card-type { font-size: 13px; color: #ccc; margin-bottom: 8px; }
        .card-stats { margin-top: auto; display: flex; justify-content: space-between; font-size: 15px; font-weight: 600; }
        .attack { color: #ff4757; }
        .health { color: #00ff88; }
        .game-controls { display: flex; gap: 16px; justify-content: center; flex-wrap: wrap; margin-bottom: 24px; }
        .btn { padding: 12px 24px; border: none; border-radius: 8px; cursor: pointer; font-size: 16px; font-weight: 600; transition: all 0.3s ease; color: white; }
        .btn-primary { background: linear-gradient(45deg, #ff6b35, #f7931e); }
        .btn-secondary { background: linear-gradient(45deg, #4a69bd, #1e3799); }
        .btn-draw { background: linear-gradient(45deg, #00ff88, #00cc70); }
        .btn-danger { background: linear-gradient(45deg, #ff4757, #ff3742); }
        .btn:disabled { opacity: 0.5; cursor: not-allowed; transform: none; }
        .game-stats { display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px; margin-bottom: 32px; }
        .stat-card { background: rgba(0, 0, 0, 0.6); padding: 20px; border-radius: 10px; text-align: center; border: 2px solid #333; }
        .stat-value { font-size: 2em; font-weight: 700; color: #ff6b35; }
        .stat-label { font-size: 0.9em; color: #ccc; margin-top: 4px; }
        .battle-log { background: rgba(0, 0, 0, 0.7); border-radius: 10px; padding: 15px; height: 150px; overflow-y: auto; border: 1px solid #444; font-size: 14px; }
        .log-entry { margin-bottom: 8px; }
        .log-damage { color: #ff4757; }
        .log-heal { color: #00ff88; }
        .log-info { color: #74b9ff; }
        .victory-screen, .defeat-screen, .artifact-screen { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.9); display: none; align-items: center; justify-content: center; z-index: 1000;}
        .victory-content, .defeat-content { text-align: center; padding: 40px; border-radius: 20px; border: 3px solid #fff; width: 90%; max-width: 400px; }
        .victory-content { background: linear-gradient(135deg, #00ff88, #00cc70); color: #000; }
        .defeat-content { background: linear-gradient(135deg, #ff4757, #ff3742); color: #fff; }
        .result-title { font-size: 3em; margin-bottom: 16px; font-weight: 700; }
        .result-title + p { font-size: 1.1em; margin-bottom: 24px; }
        .content-section { background: rgba(0, 0, 0, 0.4); border-radius: 15px; padding: 24px; margin-top: 32px; border: 1px solid #444; line-height: 1.7; }
        .content-section h3 { font-size: 1.2em; margin-top: 20px; margin-bottom: 10px; border-bottom: 1px solid #444; padding-bottom: 5px; }
        .content-section p, .content-section li { color: #ccc; }
        .content-section ul, .content-section ol { padding-left: 20px; margin-top: 10px;}
        .artifact-content { text-align: center; padding: 30px; border-radius: 20px; background: linear-gradient(135deg, #1e3c72, #2a5298); border: 3px solid #74b9ff; width: 90%; max-width: 600px; }
        .artifact-choices { display: flex; gap: 15px; margin-top: 20px; justify-content: center; flex-wrap: wrap; }
        .artifact-choice { background: #16213e; border: 2px solid #74b9ff; border-radius: 12px; padding: 15px; min-width: 150px; cursor: pointer; transition: all 0.3s ease; }
        .artifact-choice:hover { background: #2a5298; transform: scale(1.05); box-shadow: 0 0 15px #74b9ff; }
        
        @media (max-width: 900px) { 
            .game-stats { grid-template-columns: repeat(2, 1fr); } 
        }
        
        /* --- Mobile Single-Screen Layout: Final Revision --- */
        @media (max-width: 768px) {
            body { overflow: hidden; }
            .container {
                display: flex;
                flex-direction: column;
                height: 100vh;
                padding: 8px;
                gap: 8px;
            }
            .header, .content-section { display: none; }
            
            .nav a {
                display: inline-block;
                margin: 3px 5px;
                font-size: 0.8em;
                padding: 4px 8px;
            }

            .game-stats {
                order: 1; 
                display: grid;
                flex-shrink: 0;
                grid-template-columns: repeat(4, 1fr);
                gap: 6px;
                margin-bottom: 0;
                padding: 0;
            }
            .stat-card {
                background: rgba(0, 0, 0, 0.4);
                padding: 5px 2px;
                border-radius: 6px;
                border: 1px solid #333;
            }
            .stat-value { font-size: 1.5em; }
            .stat-label { font-size: 0.7em; }

            .battle-area {
                order: 2;
                flex-grow: 1;
                min-height: 0;
                display: grid;
                grid-template-columns: 1fr 1fr;
                gap: 8px;
                margin-bottom: 0;
            }
            .player-side, .enemy-side {
                padding: 8px;
                min-height: 0;
                display: flex;
                flex-direction: column;
            }
            .player-side h2, .enemy-side h2 { font-size: 1em; margin-bottom: 4px; }
            .health-bar { height: 18px; margin-bottom: 6px; }
            .health-fill { font-size: 10px; }
            .ship-container { flex-grow: 1; gap: 6px; padding-top: 4px; }
            .ship { width: 45px; height: 45px; font-size: 20px; }
            .ship-stats { font-size: 9px; padding: 1px 4px; }
            .enemy-intent { font-size: 12px; top: -8px; }

            .hand-area {
                order: 3;
                flex-shrink: 0;
                padding: 8px;
                margin-bottom: 0;
            }
            .hand-area h2 { display: none; }
            .hand { overflow-x: auto; flex-wrap: nowrap; padding-bottom: 5px; gap: 8px; }
            .card { height: 120px; min-width: 90px; padding: 6px; }
            .card:hover { transform: translateY(-5px); }
            .card-name { font-size: 12px; }
            .card-type { font-size: 10px; }
            .card-stats { font-size: 11px; }

            /* REQUIREMENT 1: Make log 3x taller */
            .battle-log {
                order: 4;
                flex-shrink: 0;
                height: 120px; /* Changed from 40px to 120px */
                padding: 5px;
                font-size: 11px;
            }

            .game-controls {
                order: 5;
                flex-shrink: 0;
                display: flex;
                flex-wrap: nowrap;
                gap: 6px;
                margin-bottom: 0;
            }
            .btn {
                flex: 1;
                min-width: 0;
                padding: 8px 4px;
                font-size: 12px;
                white-space: nowrap;
            }
        }
    </style>
</head>
<body>
    <div class="stars" id="stars"></div>
    <div class="container">
        <header class="header">
            <h1 class="title">🚀 Deckbuilding</h1>
            <div class="wave-indicator" id="waveIndicator">Wave 1: Enemies Approaching!</div>
            
            <nav class="nav">
                <a href="about.html">📖 About</a>
                <a href="contact.html">📧 Contact</a>
                <a href="privacy.html">🔒 Privacy</a>
                <a href="terms.html">📋 Terms</a>
            </nav>
        </header>

        <div class="game-stats">
            <div class="stat-card"><div class="stat-value" id="playerHealth">100</div><div class="stat-label">🛡️ Your Health</div></div>
            <div class="stat-card"><div class="stat-value" id="enemyHealth">60</div><div class="stat-label">💀 Enemy Health</div></div>
            <div class="stat-card"><div class="stat-value" id="energy">3</div><div class="stat-label">⚡ Energy</div></div>
            <div class="stat-card"><div class="stat-value" id="wave">1</div><div class="stat-label">🌊 Current Wave</div></div>
        </div>

        <div class="battle-area">
            <div class="player-side">
                <h2>🛡️ Your Fleet</h2>
                <div class="health-bar"><div class="health-fill player-health" id="playerHealthBar" style="width: 100%;">100 / 100</div></div>
                <div class="ship-container" id="playerShips"></div>
            </div>
            <div class="enemy-side">
                <h2>💀 Enemy Fleet</h2>
                <div class="health-bar"><div class="health-fill enemy-health" id="enemyHealthBar" style="width: 100%;">60 / 60</div></div>
                <div class="ship-container" id="enemyShips"></div>
            </div>
        </div>

        <div class="hand-area">
            <h2>🎴 Your Hand</h2>
            <div class="hand" id="hand"></div>
        </div>
        
        <div class="game-controls">
            <button class="btn btn-draw" onclick="drawCard()" id="drawBtn" aria-label="Draw a new card from your deck for one energy">🎴 Draw Card (1⚡)</button>
            <button class="btn btn-primary" onclick="attack()" id="attackBtn" aria-label="Order your fleet to attack the enemy">⚔️ Attack!</button>
            <button class="btn btn-danger" onclick="endTurn()" id="endTurnBtn" aria-label="End your current turn and start the next">🔄 End Turn</button>
            <button class="btn btn-secondary" onclick="resetGame()" aria-label="Restart the game from the beginning">🔄 Restart</button>
        </div>

        <div class="battle-log" id="battleLog">
            <div class="log-entry log-info">🌟 Welcome! Deploy ships to defeat the enemy.</div>
        </div>
    </div>

    <div class="victory-screen" id="victoryScreen">
        <div class="victory-content"><div class="result-title">Victory!</div><p>You have successfully defeated wave <span id="victoryWave"></span>!</p><button class="btn btn-primary" onclick="nextWave()" style="margin: 20px 10px;">Claim Reward →</button><button class="btn btn-secondary" onclick="resetGame()">Restart Game</button></div>
    </div>
    <div class="defeat-screen" id="defeatScreen">
        <div class="defeat-content"><div class="result-title">Defeat</div><p>Your fleet was destroyed on wave <span id="defeatWave"></span>.</p><p>You defeated a total of <span id="totalKills"></span> enemies.</p><button class="btn btn-primary" onclick="resetGame()" style="margin: 20px;">Try Again!</button></div>
    </div>

    <div class="artifact-screen" id="artifactScreen">
        <div class="artifact-content">
            <h2>Scan Complete. Choose a salvageable technology.</h2>
            <div class="artifact-choices" id="artifactChoices"></div>
        </div>
    </div>

    <div class="container content-section">
        <h2>About the Game</h2><p>Deckbuilding is a single-player, browser-based strategy game where you command a fleet of starships against endless waves of enemies. Combine tactics, resource management, and a little bit of luck to build the most powerful fleet and see how many waves you can survive.</p>
        
        <h3>How to Play</h3><ol><li><strong>Use Energy:</strong> Each turn you gain energy, your primary resource.</li><li><strong>Deploy Ships:</strong> Spend energy to play ship cards from your hand. Each ship has unique attack, health, and special abilities.</li><li><strong>Attack:</strong> Once your ships are deployed, hit the "Attack!" button to engage the enemy fleet. Your ships and the enemy will exchange fire.</li><li><strong>Survive and Upgrade:</strong> Defeat the enemy wave to earn rewards, upgrade your ships, and prepare for the next, more challenging encounter.</li></ol>
        
        <h3>Game Features</h3><ul><li><strong>Strategic Card Combat:</strong> Make tough decisions about which ships to deploy and when to attack.</li><li><strong>Roguelike Progression:</strong> Every game is different. Upgrade your fleet and add powerful new cards as you advance.</li><li><strong>Endless Waves:</strong> Face increasingly difficult enemies and test the limits of your strategic skill.</li><li><strong>Instant Play:</strong> No downloads required. Play directly in your browser on PC or mobile.</li><li><strong>Free to Play:</strong> Completely free with no in-app purchases or premium content.</li><li><strong>Regular Updates:</strong> New ships, features, and improvements added regularly.</li></ul>
        
        <h3>Strategy Tips</h3><ul><li><strong>Energy Management:</strong> Don't spend all your energy at once - save some for drawing cards or emergency plays.</li><li><strong>Ship Synergy:</strong> Some ships work better together. Experiment with different combinations!</li><li><strong>Artifact Selection:</strong> Choose artifacts that complement your playstyle and ship collection.</li><li><strong>Elite Waves:</strong> Every third wave is elite - prepare for tougher enemies with better rewards.</li><li><strong>Defensive Play:</strong> Sometimes it's better to build a strong defense than to attack aggressively.</li></ul>
        
        <h3>Technical Requirements</h3><ul><li><strong>Browser:</strong> Modern web browser (Chrome, Firefox, Safari, Edge)</li><li><strong>JavaScript:</strong> Must be enabled for gameplay</li><li><strong>Internet:</strong> Required for initial loading and ads</li><li><strong>Storage:</strong> Uses local browser storage for game progress</li><li><strong>Performance:</strong> Optimized for smooth gameplay on most devices</li></ul>
        
        <div style="text-align: center; margin: 30px 0; padding: 20px; background: rgba(0, 255, 136, 0.1); border-radius: 10px; border: 1px solid #00ff88;">
            <h3 style="color: #00ff88; margin-bottom: 15px;">🎮 Ready to Command Your Fleet?</h3>
            <p style="margin-bottom: 15px;">Join thousands of commanders in epic space battles!</p>
            <p><a href="about.html" style="color: #74b9ff; text-decoration: none; margin-right: 20px;">📖 Learn More</a> | <a href="contact.html" style="color: #74b9ff; text-decoration: none;">📧 Get Support</a></p>
        </div>
    </div>

    <script>
        const artifactTypes = [
            { key: 'energy_core', name: 'Energy Core', icon: '💎', description: '+1 Max Energy.' },
            { key: 'fighter_propulsion', name: 'Fighter Propulsion', icon: '🔧', description: 'All "Fighters" gain +2 Attack.' },
            { key: 'nanite_gel', name: 'Nanite Gel', icon: '🧪', description: 'Your base heals an additional 5 HP at the end of your turn.' },
            { key: 'free_draw', name: 'Tactical Database', icon: '📚', description: 'The first card you draw each turn is free.' },
            { key: 'targeting_computer', name: 'Targeting Computer', icon: '🎯', description: 'All your ships gain +1 Attack.' }
        ];

        let gameState = {};

        const shipTypes = [
            { name: 'Fighter', cost: 1, attack: 2, health: 3, icon: '🚀', skill: 'double_shot', skillDesc: '30% chance for double shot' },
            { name: 'Cruiser', cost: 2, attack: 3, health: 5, icon: '🛸', skill: 'heal', skillDesc: 'On deploy: heal 3 HP' },
            { name: 'Battleship', cost: 3, attack: 5, health: 7, icon: '🚁', skill: 'splash', skillDesc: 'Deals splash damage' },
            { name: 'Dreadnought', cost: 4, attack: 7, health: 9, icon: '🛰️', skill: 'shield', skillDesc: 'Shields allied ships' },
            { name: 'Titan', cost: 5, attack: 10, health: 12, icon: '🚀', skill: 'energy', skillDesc: 'Gains energy on attack' },
            { 
                name: 'Overclock', cost: 1, isSpell: true,
                icon: '⏩', skillDesc: 'Draw 2 cards. Lose 1 ⚡ next turn.',
                effect: (gs) => {
                    drawCard(true);
                    drawCard(true);
                    if (!gs.nextTurnEnergyModifier) gs.nextTurnEnergyModifier = 0;
                    gs.nextTurnEnergyModifier -= 1;
                    logMessage('System overclocked! Drew 2 cards at the cost of future energy.', 'heal');
                }
            },
            { 
                name: 'Orbital Strike', cost: 3, isSpell: true, consumes: true,
                icon: '🛰️💥', skillDesc: 'Deal 25 damage to the enemy fleet. Consumes.',
                effect: (gs) => {
                    const damage = 25;
                    gs.enemyHealth -= damage;
                    logMessage(`Orbital strike rains down, dealing ${damage} damage to the enemy fleet!`, 'damage');
                }
            },
            { 
                name: 'Repair Drone', cost: 2, attack: 0, health: 4, 
                icon: '🛠️', skillDesc: 'At the end of your turn, restore 3 HP to your base.',
                onTurnEnd: (gs) => {
                    gs.playerHealth = Math.min(gs.playerMaxHealth, gs.playerHealth + 3);
                    logMessage('Repair Drone whirs, restoring 3 base HP.', 'heal');
                }
            },
            {
                name: 'EMP Pulse', cost: 2, isSpell: true,
                icon: '💨', skillDesc: 'All enemies get -2 Attack this turn.',
                effect: (gs) => {
                    gs.enemyShips.forEach(enemy => {
                        if (!enemy.debuffs) enemy.debuffs = [];
                        enemy.debuffs.push({ type: 'attack', value: -2, turns: 1 });
                    });
                    logMessage('An EMP wave washes over the enemy, reducing their attack!', 'info');
                }
            }
        ];
        
        const enemyTypes = [
            { name: 'Pirate Scout', attack: 1, health: 2, icon: '💀', intents: ['attack'] },
            { name: 'Marauder', attack: 2, health: 3, icon: '☠️', intents: ['attack', 'attack', 'defend'] },
            { name: 'Warship', attack: 3, health: 5, icon: '🔥', intents: ['attack', 'buff'] },
            { name: 'Mothership', attack: 5, health: 8, icon: '👹', intents: ['attack', 'defend', 'buff'] }
        ];

        function playerHasArtifact(artifactKey) {
            return gameState.playerArtifacts.some(artifact => artifact.key === artifactKey);
        }

        function initGame() {
            createStars();
            gameState = {
                playerHealth: 100, playerMaxHealth: 100, enemyHealth: 0, enemyMaxHealth: 0,
                energy: 3, maxEnergy: 3, hand: [], playerShips: [], enemyShips: [],
                wave: 1, totalKills: 0, turn: 1,
                playerArtifacts: [], hasDrawnThisTurn: false, isEliteWave: false, nextTurnEnergyModifier: 0,
                isGameOver: false
            };
            generateInitialHand();
            generateEnemies();
            setEnemyIntents(); 
            updateDisplay();
            logMessage('🎮 Game Start! Deploy ships to defeat the enemy.', 'info');
        }

        function generateEnemies() {
            gameState.enemyShips = [];
            gameState.isEliteWave = (gameState.wave >= 3 && gameState.wave % 3 === 0);
            let enemyCount = Math.min(2 + gameState.wave, 6);
            let totalHealth = 40 + (gameState.wave * 20);
            
            if (gameState.isEliteWave) {
                enemyCount = Math.max(1, Math.floor(enemyCount / 2));
                totalHealth = Math.floor(totalHealth * 1.5);
                logMessage('⭐ Elite signal detected! A powerful foe approaches.', 'damage');
            }
            
            gameState.enemyHealth = totalHealth;
            gameState.enemyMaxHealth = totalHealth;

            for (let i = 0; i < enemyCount; i++) {
                const enemyLevel = Math.min(Math.floor(gameState.wave / 2), enemyTypes.length - 1);
                const randomEnemy = { ...enemyTypes[Math.floor(Math.random() * (enemyLevel + 1))] };
                if (gameState.isEliteWave) {
                    randomEnemy.isElite = true;
                    randomEnemy.health = Math.floor(randomEnemy.health * 1.8);
                    randomEnemy.attack = Math.floor(randomEnemy.attack * 1.5);
                }
                gameState.enemyShips.push({ ...randomEnemy, id: Date.now() + i, maxHealth: randomEnemy.health, intent: null, block: 0, isBuffed: false, debuffs: [] });
            }
        }
        
        function setEnemyIntents() {
            gameState.enemyShips.forEach(enemy => {
                const possibleIntents = enemy.intents;
                enemy.intent = possibleIntents[Math.floor(Math.random() * possibleIntents.length)];
            });
        }

        function attack() {
            if (gameState.isGameOver || gameState.playerShips.length === 0) { 
                logMessage('❌ No ships to attack with!', 'info'); 
                return; 
            }
            
            let totalDamage = 0;
            gameState.playerShips.forEach(ship => {
                let shipDamage = ship.attack;
                if (playerHasArtifact('fighter_propulsion') && ship.name === 'Fighter') { shipDamage += 2; }
                if (playerHasArtifact('targeting_computer')) { shipDamage += 1; }
                switch(ship.skill) {
                    case 'double_shot': if (Math.random() < 0.3) { shipDamage *= 2; logMessage(`⚡ ${ship.name} triggers Double Shot!`, 'heal'); } break;
                    case 'splash': const splashDamage = gameState.enemyShips.length; shipDamage += splashDamage; logMessage(`💥 ${ship.name}'s splash attack deals an extra ${splashDamage} damage!`, 'damage'); break;
                    case 'energy': gameState.energy = Math.min(10, gameState.energy + 1); logMessage(`⚡ ${ship.name}'s collector generated 1 energy!`, 'heal'); break;
                }
                totalDamage += shipDamage;
            });
            gameState.enemyHealth -= totalDamage;
            logMessage(`⚔️ Your fleet deals ${totalDamage} damage!`, 'damage');
            
            if (checkGameStatus()) return;

            let totalEnemyDamage = 0;
            logMessage('💥 Enemy fleet takes action!', 'damage');
            gameState.enemyShips.forEach(enemy => {
                let currentAttack = enemy.attack;
                if(enemy.isBuffed) { currentAttack = Math.floor(currentAttack * 1.5); enemy.isBuffed = false; }
                if (enemy.debuffs) { enemy.debuffs.forEach(debuff => { if (debuff.type === 'attack') currentAttack += debuff.value; }); currentAttack = Math.max(0, currentAttack); }
                switch(enemy.intent) {
                    case 'attack': totalEnemyDamage += currentAttack; logMessage(`  - ${enemy.name} attacks for ${currentAttack} damage!`, 'damage'); break;
                    case 'defend': const blockAmount = Math.ceil(enemy.maxHealth * 0.5); enemy.block += blockAmount; logMessage(`  - ${enemy.name} raises shields, gaining ${blockAmount} block!`, 'info'); break;
                    case 'buff': enemy.isBuffed = true; logMessage(`  - ${enemy.name} powers up for its next attack!`, 'damage'); break;
                }
            });

            let remainingDamage = totalEnemyDamage;
            for (let ship of gameState.playerShips) {
                if (remainingDamage <= 0) break;
                const damage = Math.min(remainingDamage, ship.currentHealth);
                ship.currentHealth -= damage;
                remainingDamage -= damage;
            }
            gameState.playerShips = gameState.playerShips.filter(ship => ship.currentHealth > 0);
            gameState.playerHealth -= remainingDamage;

            endTurn();
        }
        
        function checkGameStatus() {
            if (gameState.isGameOver) return true;
            if (gameState.playerHealth <= 0) {
                gameState.isGameOver = true;
                document.getElementById('defeatWave').textContent = gameState.wave;
                document.getElementById('totalKills').textContent = gameState.totalKills;
                document.getElementById('defeatScreen').style.display = 'flex';
                return true;
            }
            if (gameState.enemyHealth <= 0) {
                gameState.isGameOver = true;
                gameState.totalKills += gameState.enemyShips.length;
                gameState.enemyShips = [];
                logMessage(`🎉 Defeated enemy wave ${gameState.wave}!`, 'heal');
                document.getElementById('victoryWave').textContent = gameState.wave;
                document.getElementById('victoryScreen').style.display = 'flex';
                return true;
            }
            return false;
        }

        function endTurn() {
            if (gameState.isGameOver) return;
            gameState.playerShips.forEach(ship => { if (ship.onTurnEnd) ship.onTurnEnd(gameState); });
            gameState.turn++;
            gameState.hasDrawnThisTurn = false;
            gameState.energy = Math.min(gameState.maxEnergy, 10) + gameState.nextTurnEnergyModifier;
            gameState.nextTurnEnergyModifier = 0;
            let baseHeal = 5;
            if (playerHasArtifact('nanite_gel')) { baseHeal += 5; }
            gameState.playerHealth = Math.min(gameState.playerMaxHealth, gameState.playerHealth + baseHeal);
            gameState.enemyShips.forEach(enemy => { if(enemy.debuffs) { enemy.debuffs.forEach(debuff => debuff.turns--); enemy.debuffs = enemy.debuffs.filter(debuff => debuff.turns > 0); } });
            setEnemyIntents();
            logMessage(`🔄 Turn ${gameState.turn} begins. Plan your move!`, 'heal');
            if (checkGameStatus()) return;
            updateDisplay();
        }
        
        function nextWave() { 
            document.getElementById('victoryScreen').style.display = 'none'; 
            if (gameState.isEliteWave) {
                presentArtifactChoice();
            } else {
                startNextWave();
            }
        }

        function presentArtifactChoice() { 
            const artifactScreen = document.getElementById('artifactScreen'); 
            const choicesContainer = document.getElementById('artifactChoices'); 
            choicesContainer.innerHTML = ''; 
            const availableArtifacts = [...artifactTypes]; 
            const choices = []; 
            for (let i = 0; i < 3; i++) { if(availableArtifacts.length === 0) break; const randomIndex = Math.floor(Math.random() * availableArtifacts.length); choices.push(availableArtifacts.splice(randomIndex, 1)[0]); } choices.forEach(artifact => { const choiceEl = document.createElement('div'); choiceEl.className = 'artifact-choice'; choiceEl.innerHTML = `<div class="artifact-icon">${artifact.icon}</div><div class="artifact-name">${artifact.name}</div><div class="artifact-desc">${artifact.description}</div>`; choiceEl.onclick = () => selectArtifact(artifact); choicesContainer.appendChild(choiceEl); }); artifactScreen.style.display = 'flex'; 
        }
        
        function selectArtifact(artifact) { 
            gameState.playerArtifacts.push(artifact); 
            logMessage(`💡 Technology acquired: ${artifact.name}!`, 'heal'); 
            if (artifact.key === 'energy_core') { gameState.maxEnergy += 1; } 
            document.getElementById('artifactScreen').style.display = 'none'; 
            startNextWave(); 
        }

        function startNextWave() { 
            gameState.wave++;
            if (gameState.wave > 1 && gameState.wave % 2 === 0 && gameState.maxEnergy < 10) {
                gameState.maxEnergy++;
                logMessage(`💡 Your energy capacity has increased to ${gameState.maxEnergy}!`, 'heal');
            }
            gameState.isGameOver = false; 
            generateEnemies(); 
            setEnemyIntents(); 
            gameState.energy = Math.min(gameState.energy + 2, gameState.maxEnergy); 
            gameState.playerShips.forEach(ship => { ship.attack += 1; ship.maxHealth += 2; ship.currentHealth = ship.maxHealth; }); 
            const powerfulShip = shipTypes[Math.min(gameState.wave - 1, shipTypes.length - 1)]; 
            gameState.hand.push({ ...powerfulShip, id: Date.now() }); 
            logMessage(`🌊 Wave ${gameState.wave} approaching! Your fleet has been upgraded!`, 'heal'); 
            updateDisplay(); 
        }

        function drawCard(isFree = false) { 
            if (gameState.isGameOver) return;
            let drawCost = 1; 
            if (isFree) { drawCost = 0; } 
            else if (playerHasArtifact('free_draw') && !gameState.hasDrawnThisTurn) { drawCost = 0; } 
            if (gameState.energy >= drawCost) { 
                if (!isFree) { gameState.energy -= drawCost; gameState.hasDrawnThisTurn = true; } 
                const randomShip = shipTypes[Math.floor(Math.random() * shipTypes.length)]; 
                gameState.hand.push({ ...randomShip, id: Date.now() }); 
                logMessage(`🎴 Drew a ${randomShip.name}!`, 'info'); 
                updateDisplay(); 
            } else { 
                logMessage('❌ Not enough energy to draw!', 'info'); 
            } 
        }
        
        function playCard(cardIndex) { 
            if (gameState.isGameOver) return;
            const card = gameState.hand[cardIndex]; 
            if (card.cost > gameState.energy) { logMessage(`❌ Not enough energy! Requires ${card.cost} energy.`, 'info'); return; } 
            gameState.energy -= card.cost; 
            const playedCard = gameState.hand.splice(cardIndex, 1)[0]; 
            if (playedCard.isSpell) { 
                playedCard.effect(gameState); 
                if (playedCard.consumes) { logMessage(`${playedCard.name} is consumed and removed from your deck for this run.`, 'info'); } 
            } else { 
                const ship = { ...playedCard, maxHealth: playedCard.health, currentHealth: playedCard.health }; 
                gameState.playerShips.push(ship); 
                triggerSkill(ship); 
                logMessage(`🚀 Deployed ${ship.name}! ATK:${ship.attack} HP:${ship.health}`, 'info'); 
            } 
            if (checkGameStatus()) return;
            updateDisplay(); 
        }

        function triggerSkill(ship) { 
            switch(ship.skill) { 
                case 'heal': gameState.playerHealth = Math.min(gameState.playerMaxHealth, gameState.playerHealth + 3); logMessage(`💚 ${ship.name}'s repair systems restore 3 HP!`, 'heal'); break; 
                case 'shield': gameState.playerShips.forEach(s => { if (s.id !== ship.id) s.currentHealth = Math.min(s.maxHealth, s.currentHealth + 1); }); logMessage(`🛡️ ${ship.name} reinforces the fleet with shields!`, 'heal'); break; 
            } 
        }
        function resetGame() { 
            document.getElementById('victoryScreen').style.display = 'none'; 
            document.getElementById('defeatScreen').style.display = 'none'; 
            document.getElementById('battleLog').innerHTML = ''; 
            initGame(); 
        }
        function createStars() { const starsContainer = document.getElementById('stars'); if (!starsContainer) return; starsContainer.innerHTML = ''; for (let i = 0; i < 80; i++) { const star = document.createElement('div'); star.className = 'star'; star.style.left = Math.random() * 100 + '%'; star.style.top = Math.random() * 100 + '%'; star.style.width = Math.random() * 3 + 1 + 'px'; star.style.height = star.style.width; star.style.animationDelay = Math.random() * 3 + 's'; starsContainer.appendChild(star); } }
        function generateInitialHand() { gameState.hand = []; for (let i = 0; i < 5; i++) { const randomShip = shipTypes[Math.floor(Math.random() * Math.min(3, shipTypes.length))]; gameState.hand.push({ ...randomShip, id: Date.now() + i }); } }
        
        function updateDisplay() {
            document.getElementById('playerHealth').textContent = Math.max(0, gameState.playerHealth); 
            document.getElementById('enemyHealth').textContent = Math.max(0, Math.ceil(gameState.enemyHealth)); 
            document.getElementById('energy').textContent = gameState.energy; 
            document.getElementById('wave').textContent = gameState.wave; 
            
            const waveIndicatorEl = document.getElementById('waveIndicator'); 
            waveIndicatorEl.textContent = gameState.isEliteWave ? `Wave ${gameState.wave}: Elite Enemies Approaching!` : `Wave ${gameState.wave}: Enemies Approaching!`;
            waveIndicatorEl.classList.toggle('elite-wave-indicator', gameState.isEliteWave);
            
            const playerHealthPercent = (gameState.playerHealth / gameState.playerMaxHealth) * 100; 
            const enemyHealthPercent = (gameState.enemyHealth / gameState.enemyMaxHealth) * 100; 
            document.getElementById('playerHealthBar').style.width = playerHealthPercent > 0 ? playerHealthPercent + '%' : '0%'; 
            document.getElementById('playerHealthBar').textContent = `${Math.max(0, gameState.playerHealth)} / ${gameState.playerMaxHealth}`; 
            document.getElementById('enemyHealthBar').style.width = enemyHealthPercent > 0 ? enemyHealthPercent + '%' : '0%';
            document.getElementById('enemyHealthBar').textContent = `${Math.max(0, Math.ceil(gameState.enemyHealth))} / ${gameState.enemyMaxHealth}`; 
            
            const handEl = document.getElementById('hand'); handEl.innerHTML = ''; 
            gameState.hand.forEach((card, index) => { handEl.appendChild(createCardElement(card, index)); }); 
            
            updateShips(); 
            
            let drawCost = 1; 
            if (playerHasArtifact('free_draw') && !gameState.hasDrawnThisTurn) { drawCost = 0; } 
            document.getElementById('drawBtn').disabled = gameState.energy < drawCost || gameState.isGameOver; 
            document.getElementById('attackBtn').disabled = gameState.playerShips.length === 0 || gameState.enemyShips.length === 0 || gameState.isGameOver;
            document.getElementById('endTurnBtn').disabled = gameState.isGameOver;
        }

        function createCardElement(card, index) { 
            const cardEl = document.createElement('div'); 
            const canPlay = card.cost <= gameState.energy; 
            cardEl.className = `card ${canPlay ? 'playable' : 'unplayable'}`; 
            if (!canPlay) { cardEl.title = `Not enough energy! Requires ${card.cost}⚡, you have ${gameState.energy}⚡.`; } 
            cardEl.innerHTML = `<div class="card-cost">${card.cost}</div><div class="card-name">${card.icon} ${card.name}</div><div class="card-type">${card.skillDesc}</div><div class="card-stats">${card.attack !== undefined ? `<span class="attack">⚔️${card.attack}</span>` : ''}${card.health !== undefined ? `<span class="health">❤️${card.health}</span>` : ''}</div>`; 
            if (canPlay && !gameState.isGameOver) { cardEl.onclick = () => playCard(index); } 
            return cardEl; 
        }
        function updateShips() { 
            const playerShipsEl = document.getElementById('playerShips'); playerShipsEl.innerHTML = ''; 
            gameState.playerShips.forEach(ship => { 
                const shipEl = document.createElement('div'); 
                shipEl.className = 'ship player-ship'; 
                shipEl.innerHTML = ship.icon; 
                const statsEl = document.createElement('div'); 
                statsEl.className = 'ship-stats'; 
                statsEl.textContent = `${ship.attack}/${ship.currentHealth}`; 
                shipEl.appendChild(statsEl); 
                playerShipsEl.appendChild(shipEl); 
            }); 
            const enemyShipsEl = document.getElementById('enemyShips'); 
            enemyShipsEl.innerHTML = ''; 
            gameState.enemyShips.forEach(ship => { 
                const shipEl = document.createElement('div'); 
                shipEl.className = 'ship enemy-ship'; 
                if (ship.isElite) { shipEl.classList.add('elite-ship'); } 
                shipEl.innerHTML = ship.icon; 
                if (ship.intent) { 
                    const intentEl = document.createElement('div'); 
                    intentEl.className = 'enemy-intent'; 
                    let intentIcon = ''; 
                    let attackValue = ship.attack; 
                    if (ship.isBuffed) { attackValue = Math.floor(attackValue * 1.5); } 
                    if (ship.debuffs) { ship.debuffs.forEach(d => { if(d.type === 'attack') attackValue += d.value; }); attackValue = Math.max(0, attackValue); } 
                    switch(ship.intent) { 
                        case 'attack': intentIcon = `⚔️ ${attackValue}`; break; 
                        case 'defend': intentIcon = `🛡️ ${Math.ceil(ship.maxHealth * 0.5)}`; break; 
                        case 'buff': intentIcon = '🔥'; break; 
                    } 
                    intentEl.textContent = intentIcon; 
                    shipEl.appendChild(intentEl); 
                } 
                const statsEl = document.createElement('div'); 
                statsEl.className = 'ship-stats'; 
                let statsText = `${ship.attack}/${ship.health}`; 
                if (ship.block > 0) { statsText = `🛡️${ship.block} ` + statsText; } 
                statsEl.textContent = statsText; 
                shipEl.appendChild(statsEl); 
                enemyShipsEl.appendChild(shipEl); 
            }); 
        }
        function logMessage(message, type = 'info') { 
            const logEl = document.getElementById('battleLog'); 
            const entry = document.createElement('div'); 
            entry.className = `log-entry log-${type}`; 
            entry.textContent = message; 
            logEl.appendChild(entry); 
            logEl.scrollTop = logEl.scrollHeight; 
        }

        initGame();
    </script>
</body>
</html>
